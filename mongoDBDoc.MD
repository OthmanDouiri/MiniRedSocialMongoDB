
#### 1. **Definici√≥n de la base de datos y colecciones:**
Vamos a crear tres colecciones:  
- **Usuarios (`users`)**
- **Publicaciones (`posts`)**
- **Comentarios (`comments`)**

#### 2. **Operaciones b√°sicas en MongoDB**

Aqu√≠ tienes una serie de comandos que puedes ejecutar directamente en el **MongoDB shell** para crear y gestionar estas colecciones.

### **Pasos en MongoDB Shell**

1. **Conectar a MongoDB:**
   Si tienes **MongoDB instalado** y corriendo, abre el terminal de MongoDB para conectarte:
   ```bash
   mongo
   ```

2. **Crear una base de datos:**
   Vamos a crear la base de datos llamada `red_social`.
   ```javascript
   use red_social
   ```

3. **Crear las colecciones:**
   No es necesario crear expl√≠citamente las colecciones, ya que MongoDB las crea autom√°ticamente cuando insertamos el primer documento, pero si quieres asegurar que existen:
   ```javascript
   db.createCollection("users")
   db.createCollection("posts")
   db.createCollection("comments")
   ```

---

### **Operaciones en las colecciones**

#### **1. Insertar un usuario (colecci√≥n `users`):**
Para agregar un nuevo usuario a la colecci√≥n `users`:
```javascript
db.users.insertOne({
   username: "juan",
   email: "juan@correo.com"
})
```

Despu√©s de insertar el documento en la colecci√≥n `users`, puedes verlo con estos comandos:  

### 1Ô∏è‚É£ **Ver todos los documentos en la colecci√≥n `users`**  
```javascript
db.users.find().pretty()
```
Esto mostrar√° todos los usuarios de la colecci√≥n de forma legible.  

### 2Ô∏è‚É£ **Buscar solo el usuario reci√©n insertado**  
Como el `email` es √∫nico en este caso, puedes buscarlo as√≠:  
```javascript
db.users.findOne({ email: "juan@correo.com" })
```

### 3Ô∏è‚É£ **Si tienes el `_id` del documento insertado**  
Si el `insertOne()` te devolvi√≥ un `insertedId`, puedes buscarlo con:  
```javascript
db.users.findOne({ _id: ObjectId("67e42b06564135f3c0f3b453") })
```
(reemplaza el ID con el que se gener√≥ en tu inserci√≥n).


#### **2. Crear una publicaci√≥n (colecci√≥n `posts`):**
Para insertar una nueva publicaci√≥n, relacionada con un usuario:
```javascript
db.posts.insertOne({
   user_id: ObjectId("ID_DEL_USUARIO"), // Aqu√≠ debes usar el ObjectId de un usuario previamente insertado.
   content: "¬°Hola a todos! Esta es mi primera publicaci√≥n.",
   created_at: new Date()
})
```

#### **3. Crear un comentario (colecci√≥n `comments`):**
Para insertar un comentario en una publicaci√≥n:
```javascript
db.comments.insertOne({
   post_id: ObjectId("ID_DE_LA_PUBLICACION"),  // Aqu√≠ debes usar el ObjectId de la publicaci√≥n
   user_id: ObjectId("ID_DEL_USUARIO"),        // Usamos el ObjectId del usuario
   comment: "¬°Qu√© interesante publicaci√≥n!",
   created_at: new Date()
})
```

#### **4. Ver todos los usuarios:**
Para listar todos los usuarios:
```javascript
db.users.find().pretty()
```

#### **5. Ver todas las publicaciones:**
Para mostrar todas las publicaciones:
```javascript
db.posts.find().pretty()
```

#### **6. Ver los comentarios de una publicaci√≥n espec√≠fica:**
Para ver todos los comentarios de una publicaci√≥n:
```javascript
db.comments.find({ post_id: ObjectId("ID_DE_LA_PUBLICACION") }).pretty()
```

---

### **Resumen de operaciones posibles**

1. **Usuarios**  
   - Insertar un usuario
   - Consultar todos los usuarios

2. **Publicaciones**  
   - Insertar una publicaci√≥n
   - Consultar todas las publicaciones
   - Consultar publicaciones de un usuario espec√≠fico

3. **Comentarios**  
   - Insertar un comentario
   - Consultar los comentarios de una publicaci√≥n

---

### **Implementaci√≥n de Interfaz de Usuario en la Consola**

Si quieres una experiencia de usuario m√°s interactiva en consola, puedes crear **scripts** de **MongoDB** que ejecuten estas operaciones autom√°ticamente seg√∫n las opciones que el usuario seleccione.

## **en java**
Crear la Conexi√≥n a MongoDB
En el paquete principal, crea una nueva clase llamada DatabaseConnection.java.

Agrega el siguiente c√≥digo
``` java
import com.mongodb.client.MongoClient;
import com.mongodb.client.MongoClients;
import com.mongodb.client.MongoDatabase;

public class DatabaseConnection {
    private static final String URI = "mongodb://127.0.0.1:27017";
    private static final String DB_NAME = "red_social";
    private static MongoClient mongoClient;
    private static MongoDatabase database;

    public static MongoDatabase getDatabase() {
        if (mongoClient == null) {
            mongoClient = MongoClients.create(URI);
            database = mongoClient.getDatabase(DB_NAME);
        }
        return database;
    }

    public static void closeConnection() {
        if (mongoClient != null) {
            mongoClient.close();
        }
    }
}
```
Crear la Clase Principal
Crea un archivo llamado RedSocial.java.
``` java
import com.mongodb.client.FindIterable;
import com.mongodb.client.MongoCollection;
import com.mongodb.client.MongoDatabase;
import org.bson.Document;
import org.bson.types.ObjectId;
import java.util.Scanner;

public class RedSocial {
    public static void main(String[] args) {
        Scanner scanner = new Scanner(System.in);
        MongoDatabase database = DatabaseConnection.getDatabase();

        System.out.println("üì¢ Bienvenido a la red social en MongoDB con Java!");

        while (true) {
            System.out.println("\nüìå Seleccione una opci√≥n:");
            System.out.println("1Ô∏è‚É£ Agregar usuario");
            System.out.println("2Ô∏è‚É£ Crear publicaci√≥n");
            System.out.println("3Ô∏è‚É£ Ver publicaciones");
            System.out.println("4Ô∏è‚É£ Comentar publicaci√≥n");
            System.out.println("5Ô∏è‚É£ Salir");

            int opcion = scanner.nextInt();
            scanner.nextLine(); // Consumir el salto de l√≠nea

            switch (opcion) {
                case 1:
                    agregarUsuario(database, scanner);
                    break;
                case 2:
                    crearPublicacion(database, scanner);
                    break;
                case 3:
                    verPublicaciones(database);
                    break;
                case 4:
                    comentarPublicacion(database, scanner);
                    break;
                case 5:
                    System.out.println("üî¥ Saliendo...");
                    DatabaseConnection.closeConnection();
                    scanner.close();
                    return;
                default:
                    System.out.println("‚ö† Opci√≥n no v√°lida, intente de nuevo.");
            }
        }
    }

    public static void agregarUsuario(MongoDatabase db, Scanner scanner) {
        System.out.print("üë§ Nombre de usuario: ");
        String username = scanner.nextLine();
        System.out.print("üìß Correo electr√≥nico: ");
        String email = scanner.nextLine();

        MongoCollection<Document> users = db.getCollection("users");
        users.insertOne(new Document("username", username).append("email", email));
        System.out.println("‚úÖ Usuario agregado con √©xito.");
    }

    public static void crearPublicacion(MongoDatabase db, Scanner scanner) {
        System.out.print("üÜî ID del usuario: ");
        String userId = scanner.nextLine();
        System.out.print("üìù Publicaci√≥n: ");
        String content = scanner.nextLine();

        MongoCollection<Document> posts = db.getCollection("posts");
        posts.insertOne(new Document("user_id", new ObjectId(userId))
                .append("content", content)
                .append("created_at", new java.util.Date()));

        System.out.println("‚úÖ Publicaci√≥n creada con √©xito.");
    }

    public static void verPublicaciones(MongoDatabase db) {
        MongoCollection<Document> posts = db.getCollection("posts");
        MongoCollection<Document> users = db.getCollection("users");
        MongoCollection<Document> comments = db.getCollection("comments");

        FindIterable<Document> postList = posts.find();

        if (!postList.iterator().hasNext()) {
            System.out.println("‚ùå No hay publicaciones disponibles.");
            return;
        }

        for (Document post : postList) {
            ObjectId userId = post.getObjectId("user_id");
            Document user = users.find(new Document("_id", userId)).first();
            String username = (user != null) ? user.getString("username") : "Usuario desconocido";

            System.out.println("\n---------------------------------");
            System.out.println("üìå Publicaci√≥n ID: " + post.getObjectId("_id"));
            System.out.println("üë§ Autor: " + username + " (" + userId + ")");
            System.out.println("üìÑ Contenido: " + post.getString("content"));
            System.out.println("üìÖ Fecha: " + post.getDate("created_at"));

            // Obtener comentarios
            FindIterable<Document> commentList = comments.find(new Document("post_id", post.getObjectId("_id")));

            if (!commentList.iterator().hasNext()) {
                System.out.println("   ‚ùå No hay comentarios.");
            } else {
                System.out.println("üí¨ Comentarios:");
                for (Document comment : commentList) {
                    ObjectId commentUserId = comment.getObjectId("user_id");
                    Document commentUser = users.find(new Document("_id", commentUserId)).first();
                    String commentUsername = (commentUser != null) ? commentUser.getString("username") : "Usuario desconocido";
                    System.out.println("   üó®Ô∏è " + comment.getString("comment") + " (Usuario: " + commentUsername + ")");
                }
            }
            System.out.println("---------------------------------\n");
        }
    }

    public static void comentarPublicacion(MongoDatabase db, Scanner scanner) {
        System.out.print("üÜî ID de la publicaci√≥n: ");
        String postId = scanner.nextLine();
        System.out.print("üÜî ID del usuario: ");
        String commenterId = scanner.nextLine();
        System.out.print("üí¨ Comentario: ");
        String comment = scanner.nextLine();

        MongoCollection<Document> comments = db.getCollection("comments");
        comments.insertOne(new Document("post_id", new ObjectId(postId))
                .append("user_id", new ObjectId(commenterId))
                .append("comment", comment)
                .append("created_at", new java.util.Date()));

        System.out.println("‚úÖ Comentario agregado con √©xito.");
    }
}

``` 
## **en node.js**

``` Script node.js 
const readlineSync = require('readline-sync');
const { MongoClient, ObjectId } = require('mongodb');

async function main() {
    const client = new MongoClient("mongodb://127.0.0.1:27017");
    await client.connect();
    const db = client.db("red_social");

    console.log("Bienvenido a la red social en MongoDB!");

    while (true) {
        console.log("\nSeleccione una opci√≥n:");
        console.log("1. Agregar usuario");
        console.log("2. Crear publicaci√≥n");
        console.log("3. Ver publicaciones y comentarios");
        console.log("4. Comentar publicaci√≥n");
        console.log("5. Salir");

        let opcion = parseInt(readlineSync.question("Ingrese una opcion: "));

        if (opcion === 1) {
            let username = readlineSync.question("Ingrese el nombre de usuario: ");
            let email = readlineSync.question("Ingrese el correo del usuario: ");
            await db.collection("users").insertOne({ username, email });
            console.log("Usuario agregado con √©xito.");
        } 
        else if (opcion === 2) {
            let user_id = readlineSync.question("Ingrese el ID del usuario: ");
            let content = readlineSync.question("Ingrese la publicaci√≥n: ");
            await db.collection("posts").insertOne({ user_id: new ObjectId(user_id), content, created_at: new Date() });
            console.log("Publicaci√≥n creada con √©xito.");
        } 
        else if (opcion === 3) {
            const posts = await db.collection("posts").find().toArray();
            if (posts.length === 0) {
                console.log("No hay publicaciones disponibles.");
            } else {
                for (let post of posts) {
                    let user = await db.collection("users").findOne({ _id: post.user_id });
                    let username = user ? user.username : "Usuario desconocido";

                    console.log("\n---------------------------------");
                    console.log(`üìå Publicaci√≥n ID: ${post._id}`);
                    console.log(`üë§ Autor: ${username} (${post.user_id})`);
                    console.log(`üìÑ Contenido: ${post.content}`);
                    console.log(`üìÖ Fecha: ${post.created_at}`);

                    // Obtener comentarios del post
                    const comments = await db.collection("comments").find({ post_id: post._id }).toArray();
                    if (comments.length > 0) {
                        console.log("üí¨ Comentarios:");
                        for (let comment of comments) {
                            let commentUser = await db.collection("users").findOne({ _id: comment.user_id });
                            let commentUsername = commentUser ? commentUser.username : "Usuario desconocido";
                            console.log(`   üó®Ô∏è ${comment.comment} (Usuario: ${commentUsername}) (ID: ${comment.user_id})`);
                        }
                    } else {
                        console.log("   ‚ùå No hay comentarios.");
                    }
                    console.log("---------------------------------\n");
                }
            }
        } 
        else if (opcion === 4) {
            let post_id = readlineSync.question("Ingrese el ID de la publicaci√≥n: ");
            let user_id = readlineSync.question("Ingrese el ID del usuario: ");
            let comment = readlineSync.question("Ingrese su comentario: ");
            await db.collection("comments").insertOne({ post_id: new ObjectId(post_id), user_id: new ObjectId(user_id), comment, created_at: new Date() });
            console.log("Comentario agregado con √©xito.");
        } 
        else if (opcion === 5) {
            console.log("Saliendo...");
            await client.close();
            break;
        } 
        else {
            console.log("Opci√≥n no v√°lida, intente de nuevo.");
        }
    }
}

main().catch(console.error);

```
## Instalar Node.js y readline-sync

```powershell
npm install readline-sync mongodb
```

## Ejecutar el script en Node.js

```powershell
node menu.js
```

